<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8"/>
        <!-- ë°˜ì‘í˜• ì›¹ ì„¤ì • -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <title>MyPage - home</title>

        <!-- Firebase SDK -->
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

        <!-- Firebase ì´ˆê¸°í™” -->
        <script src="../assets/js/firebase-init.js"></script>

        <!-- ì™¸ë¶€ CSS -->
        <link rel="stylesheet" href="../assets/css/style.css" />

        <!-- Pretendard í°íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
    </head>

    <body>
        <div class="wrapper">
            
            <!--  í—¤ë”  -->
            <header class="header">
                <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
                <nav class="nav-bar">
                    <a href="index.html" class="active">Home</a>
                    <a href="about.html">About</a>
                    <a href="contact.html">Contact</a>
                    <a href="guestbook.html">ë°©ëª…ë¡</a>
                </nav>
            </header>

            <!--  ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
            <main>
                <section class="hero">
                    <div class="hero-content">
                        <div class="text">
                            <h1>ğŸ‘‹ğŸ» ì•ˆë…•í•˜ì„¸ìš”<br>Hello, Iâ€™m Jungwon</h1>
                            <p>í•œë™ëŒ€í•™êµ ì „ì‚°ì „ìê³µí•™ë¶€ ì¬í•™ì¤‘ (2021. 03. ~ )</p>
                        </div>
                        <div class="profile">
                            <img src="../assets/images/profile.png" alt="í”„ë¡œí•„">
                        </div>
                    </div>
                    <div class="buttons">
                        <a href="https://github.com/jungwonchae" class="hero-btn" target="_blank">GitHub</a>
                        <a href="#" class="hero-btn" onclick="copyToClipboard('jjungwon0222@gmail.com')">ì´ë©”ì¼</a>
                        <a href="https://www.instagram.com/zzung1_/" class="hero-btn" target="_blank">Instagram</a>
                    </div>
                </section>

                <!-- ë°©ëª…ë¡ -->
                <section class="guestbook">
                    <h2> âœğŸ»ë°©ëª…ë¡</h2>
                    <p>ë°©ëª…ë¡ì„ ë‚¨ê²¨ì£¼ì„¸ìš”!</p><br>
                    <div class="form">
                        <input type="text" id="name" placeholder="ì´ë¦„(ë³„ëª…)"/>
                        <button class="form-btn">ë“±ë¡í•˜ê¸°</button>
                        <textarea id="msg" placeholder="í•œ ì¤„ ë©”ì„¸ì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”"></textarea>
                    </div>
                    <hr>
                    <!-- ë‚´ìš© js -->
                    <div class="guestbook-list" id="guestbook-list">
                    </div>

                    <!-- ë”ë³´ê¸° ë²„íŠ¼ -->
                    <a href="guestbook.html" class="hero-btn"> ë”ë³´ê¸° </a>
                </section>
            </main>

            <!--  í‘¸í„°  -->
            <footer class="footer">
                <p>@jungwonchae</p>
            </footer>

            <!-- js -->
            <script>
                // í‹°ìŠ¤í† ë¦¬ - https://manition.tistory.com/8 ì°¸ê³ 
                function copyToClipboard(val){
                    var t = document.createElement("textarea");
                    document.body.appendChild(t);
                    t.value = val;
                    t.select();
                    document.execCommand('copy');
                    document.body.removeChild(t);
                    alert("ì´ë©”ì¼ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.ğŸ€");
                }
                // íŒŒì´ì–´ë² ì´ìŠ¤ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°.. ì§€í”¼í‹° ì°¸ê³ 
                db.collection("guestbook")
                .orderBy("createdAt", "desc")
                .limit(3)
                .get()
                .then((querySnapshot) => {
                    const list = document.getElementById("guestbook-list");
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        const li = document.createElement("li");
                        const date = data.createdAt?.toDate().toISOString().split("T")[0] ?? "ë‚ ì§œ ì—†ìŒ";
                        li.innerHTML = `
                            <strong>${data.name}</strong>
                            <span>${date}</span>
                            <p>${data.msg}</p>
                        `;
                        list.appendChild(li);
                    });
                });
                // íŒŒì´ì–´ë² ì´ìŠ¤ì— ë°ì´í„° ì €ì¥í•˜ê¸°
                document.getElementById("submit-btn").addEventListener("click", function () {
                const name = document.getElementById("name").value.trim();
                const msg = document.getElementById("msg").value.trim();

                if (!name || !msg) {
                alert("ì´ë¦„ê³¼ ë©”ì„¸ì§€ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
                }

                db.collection("guestbook")
                .add({
                    name: name,
                    msg: msg,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    alert("ë°©ëª…ë¡ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¥³");
                    document.getElementById("name").value = "";
                    document.getElementById("msg").value = "";
                    location.reload(); // ìƒˆë¡œê³ ì¹¨í•´ì„œ ëª©ë¡ ê°±ì‹ 
                })
                .catch((error) => {
                    console.error("Error writing document: ", error);
                    alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                });
            });
            </script>
        </div>
    </body>
</html>